<!-- Contenido embebido de PowerBI para el SPA - Versión alternativa -->
<div id="powerbi-container" style="height: 100vh; overflow: hidden; position: relative;">
  <div id="loading-message" style="
    position: absolute; 
    top: 50%; 
    left: 50%; 
    transform: translate(-50%, -50%); 
    text-align: center;
    font-size: 18px;
    color: #1e3a8a;
  ">
    <i class="fa fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i><br>
    Cargando Dashboard PowerBI...
  </div>
  
  <div id="error-message" style="
    position: absolute; 
    top: 50%; 
    left: 50%; 
    transform: translate(-50%, -50%); 
    text-align: center;
    font-size: 16px;
    color: #dc2626;
    display: none;
  ">
    <i class="fa fa-exclamation-triangle" style="font-size: 24px; margin-bottom: 10px;"></i><br>
    Error al cargar PowerBI Dashboard<br>
    <button onclick="loadPowerBI()" style="
      margin-top: 10px; 
      padding: 8px 16px; 
      background: #1e3a8a; 
      color: white; 
      border: none; 
      border-radius: 4px; 
      cursor: pointer;
    ">Reintentar</button>
    <br><br>
    <a href="/equi/powerB.html" target="_blank" style="
      color: #1e3a8a; 
      text-decoration: underline;
    ">Abrir PowerBI en nueva pestaña</a>
  </div>
  
  <div id="powerbi-content" style="width: 100%; height: 100%; display: none;">
    <!-- El contenido de PowerBI se cargará aquí -->
  </div>
</div>

<script>
// Script para cargar PowerBI Dashboard directamente
document.addEventListener('DOMContentLoaded', function() {
  console.log('Iniciando carga directa de PowerBI Dashboard');
  loadPowerBI();
});

function loadPowerBI() {
  const loadingMessage = document.getElementById('loading-message');
  const errorMessage = document.getElementById('error-message');
  const contentDiv = document.getElementById('powerbi-content');
  
  // Mostrar loading
  loadingMessage.style.display = 'block';
  errorMessage.style.display = 'none';
  contentDiv.style.display = 'none';
  
  console.log('Cargando PowerBI...');
  
  // Detectar la ruta correcta
  const basePath = window.location.pathname.includes('/equi/') ? '/equi/' : './';
  const powerBIPath = basePath + 'powerB.html';
  
  console.log('Cargando PowerBI desde:', powerBIPath);
  
  // Cargar el contenido de PowerBI
  fetch(powerBIPath)
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      return response.text();
    })
    .then(html => {
      console.log('PowerBI HTML cargado, procesando...');
      
      // Extraer el body content
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      const bodyContent = doc.body.innerHTML;
      
      // Insertar el contenido
      contentDiv.innerHTML = bodyContent;
      
      // Ejecutar scripts del PowerBI
      const scripts = doc.querySelectorAll('script');
      scripts.forEach(script => {
        if (script.src) {
          // Script externo
          const newScript = document.createElement('script');
          newScript.src = script.src;
          document.head.appendChild(newScript);
        } else if (script.textContent) {
          // Script inline
          try {
            eval(script.textContent);
          } catch (e) {
            console.warn('Error ejecutando script de PowerBI:', e);
          }
        }
      });
      
      // Mostrar contenido
      loadingMessage.style.display = 'none';
      contentDiv.style.display = 'block';
      
      console.log('PowerBI cargado exitosamente');
      
    })
    .catch(error => {
      console.error('Error cargando PowerBI:', error);
      loadingMessage.style.display = 'none';
      errorMessage.style.display = 'block';
      
      // Actualizar mensaje de error con detalles
      const errorDetails = document.querySelector('#error-message');
      errorDetails.innerHTML = `
        <i class="fa fa-exclamation-triangle" style="font-size: 24px; margin-bottom: 10px;"></i><br>
        Error al cargar PowerBI Dashboard<br>
        <small style="color: #888;">Error: ${error.message}</small><br>
        <button onclick="loadPowerBI()" style="
          margin-top: 10px; 
          padding: 8px 16px; 
          background: #1e3a8a; 
          color: white; 
          border: none; 
          border-radius: 4px; 
          cursor: pointer;
        ">Reintentar</button>
        <br><br>
        <a href="/equi/powerB.html" target="_blank" style="
          color: #1e3a8a; 
          text-decoration: underline;
        ">Abrir PowerBI en nueva pestaña</a>
      `;
    });
}
</script>
